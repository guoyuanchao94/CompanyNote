### 一、CMake

#### 1.1 CMake是什么

- CMake 是一个开源的跨平台自动化建构系统，用来管理软件建置的程序，并不依赖于某特定编译器，并可支持多层目录、多个应用程序与多个函数库。
- CMake 通过使用简单的配置文件 CMakeLists.txt，自动生成不同平台的构建文件（如 Makefile、Ninja 构建文件、Visual Studio 工程文件等），简化了项目的编译和构建过程。
- CMake 本身不是构建工具，而是生成构建系统的工具，它生成的构建系统可以使用不同的编译器和工具链。

#### 1.2 CMake的作用和优势

##### 1.2.1 跨平台支持

- CMake 支持多种操作系统和编译器，使得同一份构建配置可以在不同的环境中使用。

##### 1.2.2 简化配置

-  通过`CMakeLists.txt`文件，用户可以定义项目结构、依赖项、编译选项等，无需手动编写复杂的构建脚本。

##### 1.2.3 自动化构建

- CMake 能够自动检测系统上的库和工具，减少手动配置的工作量。

##### 1.2.4 灵活性

- 支持多种构建类型和配置（如`Debug`、`Release`），并允许用户自定义构建选项和模块。

#### 1.3 CMake基本工作流程

##### 1.3.1 编写 CMakeLists.txt 文件

- 定义项目的构建规则和依赖关系，比如说一个`exe`文件的生成需要哪些`cpp`文件，一个静态库的生成需要哪些`cpp`文件。

##### 1.3.2 生成构建文件

- 使用CMake生成适合当前平台的构建系统文件（例如`Makefile`、`Visual Studio`工程文件）。

比如说下面这条命令，`-G` 指定生成器为`Ninja`，`-DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++`指定编译器。`../`表示CMakeLists.txt文件相对于该命令执行所在的目录。执行完这条命令后，会在当前目录生成一些构建文件，比如我们使用Ninja作为构建工具，会生成一个`build.ninja`的文件。

```shell
cmake -G "Ninja" -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ ../
```

##### 1.3.3 执行构建

- 上述命令生成`build.ninja`文件，我们执行`ninja`即可构建项目，最终生成`exe`文件或者库文件，具体生成哪一种是看我们的`CMakeLists.txt`文件的配置。

### 二、CI/CD 

#### 2.1 CI 即持续集成

##### 2.1.1 基本概念

- 开发人员频繁将代码变更合并到一个共享代码库（通常使用 Git），可能一天多次。每次合并都会触发自动化构建和测试流程，以尽早发现问题。这能保持代码库的稳定性，减少集成冲突。常用工具包括 Jenkins、GitHub Actions、GitLab CI 和 CircleCI。

#### 2.2 CD 即持续部署

##### 2.2.1 基本概念

- 在 CI 的基础上，凡是**通过测试的代码**变更都会自动部署到**生产环境**或**预发布环境**。这实现快速、可靠的发布。有些团队使用“持续交付”，即自动化部署到预发布环境，但生产环境部署需手动批准。

#### 2.3 典型的CI/CD流程

- **代码提交：** 开发人员将代码推送到版本控制系统（如 Git）。
- **构建：** 自动化工具编译代码，生成可部署的产物（如 Docker 镜像）。
- **测试：** 运行自动化测试（单元测试、集成测试等），验证功能和性能。
- **部署：** 将通过测试的代码部署到预发布或生产环境。
- **监控：** 部署后监控应用，确保运行正常。

#### 2.4 自动构建的实现流程

##### 2.4.1 版本控制系统的触发

- 当开发人员将代码推送到版本控制系统（如 GitHub、GitLab 或 Bitbucket）的指定分支（如 main 或 develop）时，CI/CD 工具会通过 Webhook 检测到代码提交事件。
- Webhook 是一个触发机制，版本控制系统会通知 CI/CD 工具（例如 GitHub Actions、Jenkins）有新的代码变更。

##### 2.4.2 CI/CD工具执行构建

- I/CD 工具根据预定义的配置文件（规则）启动构建流程。
- 配置文件通常定义了构建环境、依赖安装、编译步骤和输出产物。
- 配置文件都是需要我们自己指定的，自己指定编译规则等。

### 三、灰度发布

#### 3.1 什么是灰度发布

- 灰度发布是指在生产环境中，先将新版本的软件或功能部署给一小部分用户（如 1% 的流量或特定用户群体），观察其表现（如稳定性、性能、用户反馈）。如果没有问题，再逐步扩大部署范围，最终完全替换旧版本。

#### 3.2 灰度发布的典型流程

- 准备新版本：开发并测试新版本代码，确保其通过基本的质量检查。
- 小规模部署：将新版本部署到生产环境的有限子集（如部分服务器、特定区域用户或随机抽样的流量）。
- 监控与验证：监控新版本的运行情况，包括错误率、性能指标和用户反馈。
- 逐步扩展： 如果新版本表现良好，逐渐增加其流量占比（如从 1% 到 10%、50% 直至 100%）。
- 回滚或完成：如果发现问题，快速回滚到旧版本；如果一切正常，完成全量发布。

### 四、特性开关

### 五、配置管理
